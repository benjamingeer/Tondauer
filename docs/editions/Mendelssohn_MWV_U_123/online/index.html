<html>
  <head>
    <title>Felix Mendelssohn - Prelude MWV U 123</title>
    <script src="verovio-toolkit.js" type="text/javascript" ></script>
    <script src="https://code.jquery.com/jquery-3.1.1.min.js" type="text/javascript" ></script>

    <style>
      /* The Modal (background) */
      .modal {
	  display: none; /* Hidden by default */
	  position: fixed; /* Stay in place */
	  z-index: 1; /* Sit on top */
	  left: 0;
	  top: 0;
	  width: 100%; /* Full width */
	  height: 100%; /* Full height */
	  overflow: auto; /* Enable scroll if needed */
	  background-color: rgb(0,0,0); /* Fallback color */
	  background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
      }

      /* Modal Header */
      .modal-header {
	  padding: 2px 16px;
	  background-color: #5cb85c;
	  color: white;
      }

      /* Modal Body */
      .modal-body {padding: 2px 16px;}

      /* Modal Content */
      .modal-content {
	  position: relative;
	  background-color: #fefefe;
	  margin: auto;
	  padding: 0;
	  border: 1px solid #555;
	  width: 80%;
	  box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19);
	  animation-name: animatetop;
	  animation-duration: 0.4s
      }

      /* Add Animation */
      @keyframes animatetop {
	  from {top: -300px; opacity: 0}
	  to {top: 0; opacity: 1}
      }

      /* The Close Button */
      .close {
	  color: #555;
	  float: right;
	  font-size: 28px;
	  font-weight: bold;
      }

      .close:hover,
      .close:focus {
	  color: black;
	  text-decoration: none;
	  cursor: pointer;
      }
    </style>

    <script type="text/javascript">
      // Annotations, which could be loaded from the Knora API.
      var annotations = {
	  "m2-annot1": {
	      title: "Measure 2, beat 2",
	      text: "<p><a href=\"http://resolver.staatsbibliothek-berlin.de/SBB0001F9E700000315\" target=\"_blank\"><strong>A1</strong> (measure 3)</a> and <strong>EN</strong> have G&#x0266F;, while <strong>ES1</strong> and <strong>EB</strong> have G&#x0266E; (with no accidental).</p>"
	  }
      };

      // A map of annotation targets to their annotations.
      var annotationTargets = {
	  "m2-annot1-target1": "m2-annot1"
      }
      
      var vrvToolkit = new verovio.toolkit();
      var zoom = 50;
      var pageHeight = 2970;
      var pageWidth = 2100;

      // Sets Verovio options.
      function setOptions() {
          pageHeight = $(document).height() * 100 / zoom ;
          pageWidth = $(window).width() * 100 / zoom ;
          options = {
              pageHeight: pageHeight,
              pageWidth: pageWidth,
              scale: zoom,
              adjustPageHeight: true,
	      spacingLinear: 0.5
          };

          vrvToolkit.setOptions(options);
      }

      // Loads the score into Verovio.
      function loadData(data) {
          setOptions();
          vrvToolkit.loadData(data);
          svg = vrvToolkit.renderToSVG(1, {});
          $("#svg_output").html(svg);
      }

      // Marks annotated elements in the score so they display
      // annotations when clicked.
      function markAnnotations() {
	  $("g").each(function(i) {
	      var elementID = $(this).attr("id");
	      var annotID = annotationTargets[elementID];
	      
	      if (annotID != undefined) {
		  $(this).attr("fill", "#f00").attr("stroke", "#f00");

		  var annotation = annotations[annotID];
		  var annotationTarget = document.getElementById(elementID);
		  var annotationModal = document.getElementById("annotation-modal");
		  var annotationModalClose = document.getElementById("annotation-modal-close");
		  
		  annotationTarget.addEventListener('click', (event) => {
		      $("#annotation-modal-title").html(annotation.title);
		      $("#annotation-modal-content").html(annotation.text);
		      annotationModal.style.display = "block";
		  });
		  
		  // When the user clicks on <span> (x), close the modal
		  annotationModalClose.addEventListener('click', (event) => {
		      annotationModal.style.display = "none";
		  });
	      }
	  });
      }
      
      $(document).ready(function() {
          var file = "Mendelssohn_MWV_U_123.xml";
          $.ajax({
              url: file,
              dataType: "text",
              success: function(data) {
                  loadData(data);
		  markAnnotations();
              }
          });
      });
      </script>
  </head>
  <body>
    <!-- Verovio's SVG output is displayed in this div. -->
    <div id="svg_output"></div>

    <!-- A modal dialog for displaying annotations. -->
    <div id="annotation-modal" class="modal">
      <div class="modal-content">
	<div class="modal-header">
	  <span id="annotation-modal-close" class="close">&times;</span>
	  <h2 id="annotation-modal-title"></h2>
	</div>
	<div id="annotation-modal-content" class="modal-body"></div>
      </div>
    </div>
  </body>
</html>
